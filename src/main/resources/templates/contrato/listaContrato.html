<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layoutSecretaria}">

<head>
    <title>Lista de Contratos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/css/estilosContrato.css}">

</head>

<body>
<div layout:fragment="content">
    <div class="container mt-4">

        <!-- TÃ­tulo sin fondo celeste -->
        <div class="mb-4 p-2 rounded-4">
            <h4 class="text-center mb-0 text-black">Lista de Contratos</h4>
        </div>

        <!-- Buscador personalizado + botÃ³n nuevo -->
        <div class="mb-3 d-flex justify-content-between">
			<div>
			    <input type="text" id="filtroNombre" class="form-control input-busqueda" placeholder="ðŸ” Buscar cliente (nombre o apellido)">
			</div>
            <a th:href="@{/contrato/registrar}" class="btn btn-primary">+ Nuevo Contrato</a>
        </div>

        <div class="card shadow rounded-4">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="tablaContratos" class="table table-hover align-middle">
                        <thead class="table-primary text-center">
                            <tr>
                                <th>ID</th>
                                <th>Fecha</th>
                                <th>Cliente(s)</th>
                                <th>Lote(s)</th>
                                <th>Monto Total</th>
                                <th>Inicial</th>
                                <th>Saldo</th>
                                <th>NÂ° Letras</th>
                                <th>Observaciones</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="contrato, iter : ${listaContratos}">
                                <td th:text="${iter.index + 1}"></td>
                                <td th:text="${#dates.format(contrato.fechaContrato, 'dd/MM/yyyy')}"></td>

                                <td class="cliente-nombre">
                                    <ul class="list-unstyled mb-0" th:if="${!#lists.isEmpty(contrato.clientes)}" th:each="cc : ${contrato.clientes}">
                                        <li th:text="${cc.cliente.nombre + ' ' + cc.cliente.apellidos}"></li>
                                    </ul>
                                    <span th:if="${#lists.isEmpty(contrato.clientes) and contrato.separacion != null}"
                                          th:text="${contrato.separacion.cliente.nombre + ' ' + contrato.separacion.cliente.apellidos}"></span>
                                </td>

                                <td>
                                    <ul class="list-unstyled mb-0" th:if="${!#lists.isEmpty(contrato.lotes)}" th:each="cl : ${contrato.lotes}">
                                        <li th:text="'Mz ' + ${cl.lote.manzana} + ' - Lt ' + ${cl.lote.numeroLote}"></li>
                                    </ul>
                                    <span th:if="${#lists.isEmpty(contrato.lotes) and contrato.separacion != null}"
                                          th:text="'Mz ' + ${contrato.separacion.lote.manzana} + ' - Lt ' + ${contrato.separacion.lote.numeroLote}"></span>
                                </td>

                                <td th:text="'$ ' + ${#numbers.formatDecimal(contrato.montoTotal, 1, 'POINT', 2, 'COMMA')}"></td>
                                <td th:text="'$ ' + ${#numbers.formatDecimal(contrato.inicial, 1, 'POINT', 2, 'COMMA')}"></td>
                                <td th:text="'$ ' + ${#numbers.formatDecimal(contrato.saldo, 1, 'POINT', 2, 'COMMA')}"></td>
                                <td th:text="${contrato.cantidadLetras}"></td>
                                <td th:text="${contrato.observaciones}"></td>

                                <td class="text-center">
                                    <a th:href="@{/contrato/editar/{id}(id=${contrato.idContrato})}" class="btn btn-sm btn-warning me-1" title="Editar">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>
                                    <a th:href="@{/contrato/eliminar/{id}(id=${contrato.idContrato})}" class="btn btn-sm btn-danger" title="Eliminar"
                                       onclick="return confirm('Â¿EstÃ¡s seguro de eliminar este contrato?');">
                                        <i class="bi bi-trash3"></i>
                                    </a>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(listaContratos)}">
                                <td colspan="10" class="text-center text-muted">No hay contratos registrados.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<div layout:fragment="scripts">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="/js/listarContrato.js"></script> <!-- âœ… Tu archivo, tu ruta -->
</div>
</body>
</html>
